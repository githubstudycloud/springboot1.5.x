您提出了一个很好的问题，关于如何在 Spring Boot 项目中升级嵌入式 Tomcat 的版本。Spring Boot 2.7.18 默认使用的是 Tomcat 9.0.83，但您希望升级到 9.0.91。这是一个合理的需求，因为新版本可能包含重要的 bug 修复和安全更新。让我为您详细说明如何实现这一升级。



```xml
<properties>
    <!-- 其他属性 -->
    <tomcat.version>9.0.91</tomcat.version>
</properties>

<dependencies>
    <!-- Spring Boot Web Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
        <exclusions>
            <exclusion>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-tomcat</artifactId>
            </exclusion>
        </exclusions>
    </dependency>
    
    <!-- 使用指定版本的 Tomcat -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-tomcat</artifactId>
        <version>${project.parent.version}</version>
        <exclusions>
            <exclusion>
                <groupId>org.apache.tomcat.embed</groupId>
                <artifactId>tomcat-embed-core</artifactId>
            </exclusion>
            <exclusion>
                <groupId>org.apache.tomcat.embed</groupId>
                <artifactId>tomcat-embed-el</artifactId>
            </exclusion>
            <exclusion>
                <groupId>org.apache.tomcat.embed</groupId>
                <artifactId>tomcat-embed-websocket</artifactId>
            </exclusion>
        </exclusions>
    </dependency>
    
    <!-- 明确指定 Tomcat 组件版本 -->
    <dependency>
        <groupId>org.apache.tomcat.embed</groupId>
        <artifactId>tomcat-embed-core</artifactId>
        <version>${tomcat.version}</version>
    </dependency>
    <dependency>
        <groupId>org.apache.tomcat.embed</groupId>
        <artifactId>tomcat-embed-el</artifactId>
        <version>${tomcat.version}</version>
    </dependency>
    <dependency>
        <groupId>org.apache.tomcat.embed</groupId>
        <artifactId>tomcat-embed-websocket</artifactId>
        <version>${tomcat.version}</version>
    </dependency>
</dependencies>

```



# 升级 Spring Boot 项目中的嵌入式 Tomcat 版本

## 升级步骤

1. 在 `pom.xml` 文件的 `<properties>` 部分添加 Tomcat 版本属性：
   ```xml
   <properties>
       <tomcat.version>9.0.91</tomcat.version>
   </properties>
   ```

2. 在 `<dependencies>` 部分，排除 `spring-boot-starter-web` 中的默认 Tomcat starter：
   ```xml
   <dependency>
       <groupId>org.springframework.boot</groupId>
       <artifactId>spring-boot-starter-web</artifactId>
       <exclusions>
           <exclusion>
               <groupId>org.springframework.boot</groupId>
               <artifactId>spring-boot-starter-tomcat</artifactId>
           </exclusion>
       </exclusions>
   </dependency>
   ```

3. 添加自定义版本的 Tomcat 依赖：
   ```xml
   <dependency>
       <groupId>org.springframework.boot</groupId>
       <artifactId>spring-boot-starter-tomcat</artifactId>
       <version>${project.parent.version}</version>
       <!-- 排除默认版本的 Tomcat 组件 -->
   </dependency>
   
   <!-- 添加指定版本的 Tomcat 组件 -->
   <dependency>
       <groupId>org.apache.tomcat.embed</groupId>
       <artifactId>tomcat-embed-core</artifactId>
       <version>${tomcat.version}</version>
   </dependency>
   <dependency>
       <groupId>org.apache.tomcat.embed</groupId>
       <artifactId>tomcat-embed-el</artifactId>
       <version>${tomcat.version}</version>
   </dependency>
   <dependency>
       <groupId>org.apache.tomcat.embed</groupId>
       <artifactId>tomcat-embed-websocket</artifactId>
       <version>${tomcat.version}</version>
   </dependency>
   ```

4. 保存 `pom.xml` 文件并刷新 Maven 项目。

## 注意事项

1. 兼容性：确保选择的 Tomcat 版本与您的 Spring Boot 版本兼容。
2. 全面测试：升级后进行全面测试，包括功能测试和性能测试。
3. 安全性：检查新版本 Tomcat 的安全公告，确保解决了已知的安全问题。
4. 应用程序行为：监控应用程序的启动过程和运行时行为，确保没有意外的副作用。
5. 日志检查：检查应用程序日志，确保没有与 Tomcat 相关的警告或错误。
6. 性能监控：在测试和生产环境中密切监控应用程序的性能指标。
7. 回滚计划：准备回滚计划，以防升级后出现重大问题。

## 潜在影响

- 启动时间：新版本可能影响应用程序的启动时间。
- 内存使用：内存使用模式可能会有所变化。
- 并发处理：请求处理的并发性能可能会有所不同。

在完成升级后，密切关注这些方面，并与升级前的基准进行比较。



通过以上配置和步骤，您可以将 Spring Boot 项目中的嵌入式 Tomcat 版本从 9.0.83 升级到 9.0.91。这种方法允许您精确控制 Tomcat 组件的版本，同时保持与 Spring Boot 的兼容性。

记住，虽然这种小版本升级通常是安全的，但它仍然可能引入细微的变化。因此，全面测试和监控是非常重要的。特别注意应用程序的启动过程、运行时行为和性能指标。

如果您在升级过程中遇到任何问题，或者需要关于如何处理特定的兼容性问题的建议，请随时告诉我。我很乐意提供进一步的帮助和指导。